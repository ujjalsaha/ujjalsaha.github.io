<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script src='https://d3js.org/d3.v4.min.js'></script>
<style type="text/css">
    body {
        font: 12px sans-serif;
    }

    /* Link Styles */
    ul {
        padding: 0;
        width: 100%;
    }

    li {
        display: inline;
    }

    .selected {
        outline: none;
        text-decoration: none;
        display: inline-block;
        width: 19.5%;
        margin-right: 0.625%;
        text-align: center;
        line-height: 3;
        color: black;
        background: lightgray;
    }

    .slide_button {
        outline: none;
        text-decoration: none;
        display: inline-block;
        width: 19.5%;
        margin-right: 0.625%;
        text-align: center;
        line-height: 3;
        color: black;
    }

    li:last-child .slide_button {
        margin-right: 0;
    }

    .slide_button:link, .slide_button:visited, .slide_button:focus {
        background: burlywood;
    }

    .slide_button:hover {
        background: coral;
    }

    .slide_button:active {
        background: orangered;
        color: white;
    }
    /* STOP Link Styles */

    /* On mouse hover, lighten state color */
    path:hover {
        fill-opacity: .7;
    }

    /* Style for Custom Tooltip */
    div.tooltip {
        position: absolute;
        text-align: left;
        width: 150px;
        height: 50px;
        padding: 10px;
        font: 12px sans-serif;
        background: linen;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }

    /* Legend Position Style */
    .legend {
        position:absolute;
        left:1475px;
        top:730px;
    }

    .line {
         fill: none;
         stroke: steelblue;
         stroke-width: 2px;
    }

    .grid line {
        stroke: lightgrey;
        stroke-opacity: 0.7;
        shape-rendering: crispEdges;
    }

    .grid path {
        stroke-width: 0;
    }

    .header_div {
        padding-top: 20px;
        padding-bottom: 20px;
        padding-left: 20px;
        padding-right: 20px;
        max-width: 1600px;
        border: 3px solid #73ad21;
        line-height: 20px;
        color: grey;
    }

    div {
        border: 3px solid #73ad21;

    }
    svg {
        border: 3px solid #AAAE92;
    }

    span.guideline_header {
        font-weight: bold;
        font-size: large;
        color: gray
    }

    span.bold {
        font-weight: bold;
    }

    .overlay {
        fill: none;
        pointer-events: all;
    }

    .focus circle {
        fill: steelblue;
    }

    .focus text {
        font-size: 10px;
    }

    .tooltip1{
        fill: white;
        stroke: #000;
    }

    .tooltip-date, .tooltip-cases {
        font-weight: bold;
    }
</style>


</head>
<body>
<div class="header_div">
    <span class="guideline_header">Narrative Visualization Walkthrough - Demonstrating Interactive Slideshow using COVID-19 Dataset for United States</span><br/>
    This is a demonstration of Narrative Visualisation using the Interactive Slideshow Structure using the COVID-19 Dataset of United States and tries to establish sequence of hierarchies putting forward the observation in terms of various Scenes as pages and the final page being the summary.
    This whole Visualization is based on three Scenes.
    <p>
        <span class="bold">Scene 1 (United States - COVID-19 Overall Case Count):</span> where author puts forwards the observation with overall cases on the states of United States  and being within scene1 lets user explore with the tooltip, parameters and triggers.<br/>
        <span class="bold">Scene 2 (United States - COVID-19 New Case Count):</span> where author puts forwards the observation with new cases on the states of United States and being within scene2 lets user explore the visualization with the tooltip, parameters and triggers.<br/>
        <span class="bold">Scene 3 (United States - COVID-19 Top 10 States):</span> where author puts forwards the observation of top10 states with overall positive case counts vs top10 states with new case counts. Also letting the user explore the visualization with the tooltip, parameters and triggers. This is the summary and end of the narrative visualization.<br/>
    </p>
    <p>
        <span class="bold">Navigation: </span>To move to next slides/pages, use the Prev and Next links below, or just click the button to jump to a page.
    </p>
</div>
<div class="header_div" style="text-align: center">
    <a style="color: #aaaaaa" href="#">Prev</a>
    <ul>
        <li><span class="selected" href="#">Overall Cases</span></li>
        <li><a class="slide_button" href="#">New Cases</a></li>
        <li><a class="slide_button" href="#">Top States</a></li>
    </ul>
    <a style="color:darkmagenta" href="#">Next</a>

</div>
<div class="header_div">
    <span class="guideline_header">Scene 1 - Overall Cases: </span> Shows impact of COVID-19 across states in United States but in terms of cumulative confirmed cases.
    The Scene is comprised of a Map chart and Line Chart that shows how overall cases has impacted various states since beginning of pandemic and how overall cases has increased over the period (cumulative) and is still increasing. More description and user control options are mentioned on respective charts.
</div>
<br/>
<div class="header_div">
    <table border="1">
        <tr>
            <td valign="top">
                <div style="max-width: 700px; line-height: 20px;padding: 20px">
                    <span class="guideline_header">Map - Showing Cumulative Confirmed Cases for Each States of United States</span><br/>
                    <p>
                        Seeing the total number of confirmed cases over time, can illustrate how the pandemic is expanding within the country.
                        The map shows cumulative cases for each states – which means, till date the total number of people who have ever tested positive for coronavirus in United States, regardless of whether they have recovered or died.
                        The coloring scheme shows red (most affected) to gray (least affected) states. Here we see many states have been affected so far with most no of positive cases.
                        From the map, as <span class="bold"> observation </span> we see states like New York, California, New Jersey, Florida, Texas etc are the hard hit areas with highest count of cumulative COVID-19 cases so far.
                    </p>
                    <p>
                        <span class="bold">User Controls:</span><br/>
                        The map is interactive with limited user controls and below are the user controls listed so user can explore further tweaking some parameters:<br/>
                        &nbsp;&nbsp;1. <span class="bold" style="color: chocolate; font-size: small"> Tooltip </span> -> Hovering over any state shows the cases counts and few other info.<br/>
                        &nbsp;&nbsp;2. <span class="bold" style="color: chocolate; font-size: small"> Cross Filter (Parameter: State)</span> -> Clicking a state from the map with bring up respective state's cumulative case count on the line chart.<br/>
                    </p>
                </div>
            </td>
            <td>
                <div style="text-align: center; font-size: medium; text-decoration: underline; color: black">United States Map - Overall Case Count (Cumulative)</div>
                <div id="svg_1"></div>
            </td>
        </tr>
    </table>
</div>
<br/>
<div class="header_div">
    <table border="1">
        <tr>
            <td valign="top" >
                <div style="max-width: 700px; line-height: 20px;padding: 20px">
                    <span class="guideline_header">Line Chart - Cumulative Confirmed Cases and Deaths for the United States</span><br/>
                    <p>
                        The line chart here shows:<br/>
                        &nbsp;&nbsp;1. For entire United States at what pace the overall cases are increasing<br/>
                        &nbsp;&nbsp;2. If user clicks on a state on the above map, as cross-filter is enable, the view on the line chart will switch to state level and will show state level overall case count.<br/>
                    </p>
                    <p>
                        An fine <span class="bold"> observation </span> we noticed this graph has an upward bend that can indicate more cases are being report in last few weeks then ever before.
                        Around late June, when the lockdown was lifted, there is sudden rise in the curve which would mean as states are opening more community spreading is also aggressive.
                        The color blue was used just to make it appealing, where blue itself has no color significance on the line chart.
                    </p>
                    <p>
                        <span class="bold">Annotations:</span><br/>
                        The line chart has also couple of annotations:<br/>
                        &nbsp;&nbsp;1. A vertical line that shows when states re-opened from lockdown. This lets user to see post lockdown effect of coronavirus on people.<br/>
                        &nbsp;&nbsp;2. At the tip of the line chart, show the total case count for the latest date.<br/>
                    </p>
                    <p>
                        <span class="bold">User Controls:</span><br/>
                        The line is also interactive with limited user controls and below are the user controls listed so user can explore further tweaking some parameters:<br/>
                        &nbsp;&nbsp;1. <span class="bold" style="color: chocolate; font-size: small"> Tooltip </span> -> Hovering over on line chart area will display the tooltip showing case count on that particular day.<br/>
                        &nbsp;&nbsp;2. <span class="bold" style="color: chocolate; font-size: small"> Button (Switch to Country Level)  </span> -> Also a button is provided for user to let switch on entire United States data at any point of time during the interaction .<br/>
                    </p>
                </div>
            </td>
            <td>
                <div id="svg_2" ></div>
            </td>
        </tr>
    </table>
</div>
<br/>
<div class="header_div">
    <span class="guideline_header">Definitions of the Parameters:</span><br/>
    1. <span class="bold">Confirmed Cases:</span> A confirmed case is a person who has a positive test result from an FDA approved diagnostic molecular test.<br/>
    2: <span class="bold">Date: </span>Date on which data was compiled by the data provider.<br/>
    3. <span class="bold">States: </span>States of the United States.<br/> Cross-filter is enabled on this scnene letting the user to see state level confirmed cases.
</div>
<br/>
<div class="header_div">
    <span class="guideline_header">General Facts<br/></span>
    1. All coronavirus related data used on the graphs and analysis were gathered from https://covidtracking.com/data/api <br/>
    2. All dates and times are in US eastern time (ET). <br/>
    3.
</div>

<script type="text/javascript">

/*  This visualization was made possible by modifying code provided by:

Scott Murray, Choropleth example from "Interactive Data Visualization for the Web" 
https://github.com/alignedleft/d3-book/blob/master/chapter_12/05_choropleth.html   
		
Malcolm Maclean, tooltips example tutorial
http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html

Mike Bostock, Pie Chart Legend
http://bl.ocks.org/mbostock/3888852  */

		
//Width and height of map
var margin = {top: 0, right: 0, bottom: 0, left: 0}
var width = 850;
var height = 500;

// D3 Projection
var projection = d3.geoAlbersUsa()
				   .translate([width/2, height/2])    // translate to center of screen
				   .scale([1000]);          // scale things down so see entire US
        
// Define path generator
var path = d3.geoPath()               // path generator that will convert GeoJSON to SVG paths
		  	 .projection(projection);  // tell path generator to use albersUsa projection

		
// Define linear scale for output
var color = d3.scaleLinear().domain([0, 400000]).range(["gainsboro", "red"])
var legendText = ["Minimum Cases", "Maximum cases"];

//Create SVG element and append map to the SVG
var svg = d3.select("#svg_1")
			.append("svg")
			.attr("width", width)
			.attr("height", height - margin.top);

// Append Div for tooltip to SVG
var div = d3.select("body")
		    .append("div")   
    		.attr("class", "tooltip")               
    		.style("opacity", 0);

// Load Cumulative State Data
d3.csv("state_cumulative.csv", function(data) {
//color.domain([0,500000]); // setting the range of the input data

    var selected_state = ""

    var parseDate = d3.timeParse("%Y%m%d"),
        bisectDate = d3.bisector(function(d) { return d.date; }).left,
        formatValue = d3.format(","),
        dateFormatter = d3.timeFormat("%B %d, %Y");

    // Load GeoJSON data and merge with states data
    d3.json("us-states.json", function(json) {

        // Loop through each state data value in the .csv file
        for (var i = 0; i < data.length; i++) {

            // Grab State Name
            var dataState = data[i].state;

            // Grab positive cases
            var dataValue = data[i].positive;

            // Grab death
            var dataDeath = data[i].death;


            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++)  {
                var jsonState = json.features[j].properties.name;

                if (dataState === jsonState) {

                // Copy the data value into the JSON
                    json.features[j].properties.state = dataState;
                    json.features[j].properties.positive = dataValue;
                    json.features[j].properties.death = dataDeath;

                // Stop looking through the JSON
                break;
                }
            }
        }

        // Bind the data to the SVG and create one path per GeoJSON feature
        svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#fff")
            .style("stroke-width", "1")
            .style("fill", function(d) {
                // Get data value
                var value = d.properties.positive;

                if (value) {
                //If value exists…
                return color(value);
                } else {
                //If value is undefined…
                //return "rgb(213,222,217)";
                    return "gray";
                }
            })
            .on("mouseover", function(d) {
                var tooltip_html  = "<span class='bold' style='font-size: medium;color: maroon'>" + d.properties.state + "</span><br/>" +
                            "<span class='bold'> Confirmed Cases: </span>" + formatValue(d.properties.positive) + "<br/>" +
                            "<span class='bold'> Deaths: </span>" + formatValue(d.properties.death) + "<br/>";
                div.transition()
                    .duration(200)
                    .style("opacity", .9);
                div.html(tooltip_html)
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 15) + "px")
            })
            // fade out tooltip on mouse out
            .on("mouseout", function(d) {
                div.transition()
                    .duration(500)
                    .style("opacity", 0);
            })
            .on("click", function(d) {
                // Read the data
                selected_state = d.properties.state
                d3.csv("all_states_master.csv",
                    // When reading the csv, I must format variables:
                    function(d){
                        val = { state: d.state,
                                date: parseDate(d.date),
                                positive: d.positive,
                                death: d.death}
                        // console.log("Val: " + val)
                        return val
                    },

                    // Now I can use this dataset:
                    function(data) {
                        // Clear the SVG Chart
                        svg_2.selectAll("*").remove();

                        // Filter the dataset to get selected state rows only
                        var filterdata = data.filter(function (d) {
                            return d.state == selected_state
                        })
                        var max_positive = filterdata[0].positive

                        filterdata.sort(function(a, b) {
                            return a.date - b.date;
                        });

                        // Add the title for the line graph
                        svg_2.append("text")
                            .attr("x", (width / 2) - 10)
                            .attr("y", 0 - (margin.top / 2))
                            .attr("text-anchor", "middle")
                            .style("font-size", "16px")
                            .style("text-decoration", "underline")
                            .text(d.properties.state + " - Overall Case Count (Cumulative) ");

                        // Add X axis --> it is a date format
                        var x_2 = d3.scaleTime()
                            .domain(d3.extent(filterdata, function (d) {
                                return d.date;
                            }))
                            .range([0, width]);
                        svg_2.append("g")
                            .attr("transform", "translate(0," + height + ")")
                            .call(d3.axisBottom(x_2));

                        // Add the text label for the x axis
                        svg_2.append("text")
                            .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom - 20) + ")")
                            .style("text-anchor", "middle")
                            .text("Date - [Mar 16, 2020 Onwards]");

                        // Add Y axis
                        var y_2 = d3.scaleLinear()
                            .domain([0, 450000])
                            .range([height, 0]);
                        svg_2.append("g")
                            .call(d3.axisLeft(y_2));

                        // gridlines in y axis function
                        function make_y_gridlines() {
                            return d3.axisLeft(y_2)
                                .ticks(10)
                        }

                        // add the Y gridlines
                        svg_2.append("g")
                            .attr("class", "grid")
                            .call(make_y_gridlines()
                                .tickSize(-width)
                                .tickFormat("")
                            )

                        // Add the text label for the Y axis
                        svg_2.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - (margin.left / 2) - 30)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Number of People Affected");

                        // Add the line for confirmed
                        const path = svg_2.append("path")
                            .datum(filterdata)
                            .attr("fill", "none")
                            .attr("stroke", "steelblue")
                            .attr("stroke-width", 3)
                            .attr("d", d3.line()
                                .x(function (d) {
                                    return x_2(d.date)
                                })
                                .y(function (d) {
                                    return y_2(d.positive)
                                })
                            );

                        // Add the label at the tip of the line
                        svg_2.append("text")
                            .attr("transform", "translate("+(width - 50)+","+(y_2(max_positive) - 10)+")")
                            .attr("dy", ".35em")
                            .attr("text-anchor", "start")
                            .style("font-size", "12px")
                            .style("font-weight", "bold")
                            .text(formatValue(max_positive));

                        // Add the rectangle for annotation
                        svg.append("rect")
                            .attr("class", "annotation_box")
                            .attr("width", 80)
                            .attr("height", 50)
                            .attr("x", -80)
                            .attr("y", -60)
                            .attr("rx", 4)
                            .attr("ry", 4);

                        // Add the line for annotation
                        var xy = [];
                        xy.push({x: 510, y: 300})
                        xy.push({x: 510, y: 0})
                        svg_2.append("path")
                            .datum(xy)
                            .attr("fill", "none")
                            .attr("stroke", "pink")
                            .attr("stroke-width", 2)
                            .attr("d", d3.line()
                                .x(function(d) { return d.x;})
                                .y(function(d) { return d.y;})
                            )

                        // Add annotation text
                        svg_2.append("text")
                            .attr("x", 425)
                            .attr("y", 30)
                            .attr("text-anchor", "middle")
                            .style("font-size", "10px")
                            .style("font-weight", "bold")
                            .style("fill", "deeppink")
                            .text("States reopening after lockdown");

                        // Add Tooltip for line chart
                        var focus = svg_2.append("g")
                            .attr("class", "focus")
                            .style("display", "none");

                        focus.append("circle")
                            .attr("r", 5);

                        focus.append("rect")
                            .attr("class", "tooltip1")
                            .attr("width", 80)
                            .attr("height", 50)
                            .attr("x", -80)
                            .attr("y", -60)
                            .attr("rx", 4)
                            .attr("ry", 4);

                        focus.append("text")
                            .attr("class", "tooltip-date")
                            .attr("x", -75)
                            .attr("y", -45);

                        focus.append("text")
                            .attr("x", -75)
                            .attr("y", -32)
                            .text("Cases:");

                        focus.append("text")
                            .attr("class", "tooltip-cases")
                            .attr("x", -40)
                            .attr("y", -32);

                        svg_2.append("rect")
                            .attr("class", "overlay")
                            .attr("width", width)
                            .attr("height", height)
                            .on("mouseover", function() { focus.style("display", null); })
                            .on("mouseout", function() { focus.style("display", "none"); })
                            .on("mousemove", mousemove);

                        function mousemove() {
                            var x0 = x_2.invert(d3.mouse(this)[0]),
                                i = bisectDate(filterdata, x0, 1),
                                d0 = filterdata[i - 1],
                                d1 = filterdata[i],
                                d = x0 - d0.date > d1.date - x0 ? d1 : d0;
                            focus.attr("transform", "translate(" + x_2(d.date) + "," + y_2(d.positive) + ")");
                            focus.select(".tooltip-date").text(dateFormatter(d.date));
                            focus.select(".tooltip-cases").text(formatValue(d.positive));
                        }

                     }
                );
            });
    });
});

// Add the title for the map
svg.append("text")
    .attr("x", (width / 2))
    .attr("y", 0 - (margin.top / 2) + 20)
    .attr("text-anchor", "middle")
    .style("font-size", "16px")
    .style("text-decoration", "underline")
    .text("United States - Overall Case Count (Cumulative) ");

// Modified Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852
// add a legend
var l_w = 120, l_h = 210;

// Add legend for map
var key = svg.append("g")
    .attr("width", l_w)
    .attr("height", l_h)
    .attr("class", "legend");

var legend = key.append("defs")
    .append("svg:linearGradient")
    .attr("id", "gradient")
    .attr("x1", "100%")
    .attr("y1", "0%")
    .attr("x2", "100%")
    .attr("y2", "100%")
    .attr("spreadMethod", "pad");

legend.append("stop")
    .attr("offset", "0%")
    .attr("stop-color", "red")
    .attr("stop-opacity", 1);

legend.append("stop")
    .attr("offset", "100%")
    .attr("stop-color", "gainsboro")
    .attr("stop-opacity", 1);

key.append("rect")
    .attr("width", 20)
    .attr("height", 200)
    .style("fill", "url(#gradient)")
    .attr("transform", "translate(760,275)");


var y = d3.scaleLinear()
    .range([200, 0])
    .domain([0, 450000]);

var yAxis = d3.axisRight(y);

key.append("g")
    .attr("class", "y axis")
    .attr("transform", "translate(780,275)")
    .call(yAxis)



</script>
<script>
    var formatValue = d3.format(",")
    var parseDate = d3.timeParse("%Y%m%d"),
        bisectDate = d3.bisector(function(d) { return d.date; }).left,
        formatValue = d3.format(","),
        dateFormatter = d3.timeFormat("%B %d, %Y");


    // set the dimensions and margins of the graph
    var margin = {top: 40, right: 30, bottom: 60, left: 100},
        width = 850 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg_2 = d3.select("#svg_2")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    country_cases()

    function country_cases() {
        svg_2.selectAll("*").remove();
        //Read the data
        d3.csv("country_cumulative.csv",

            // When reading the csv, I must format variables:
            function (d) {
                // console.log(d.date, d.positive)
                val = {date: d3.timeParse("%Y%m%d")(d.date), value: d.positive, death: d.death}
                // console.log(val)
                return val
            },

            // Now I can use this dataset:
            function (data) {
                // Add the title for the line graph
                svg_2.append("text")
                    .attr("x", (width / 2) - 10)
                    .attr("y", 0 - (margin.top / 2))
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .style("text-decoration", "underline")
                    .text("United States - Overall Case Count (Cumulative) ");

                // Add X axis --> it is a date format
                var x_2 = d3.scaleTime()
                    .domain(d3.extent(data, function (d) {
                        return d.date;
                    }))
                    .range([0, width]);
                svg_2.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x_2));

                // Add the text label for the x axis
                svg_2.append("text")
                    .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom - 20) + ")")
                    .style("text-anchor", "middle")
                    .text("Date - [Mar 16, 2020 Onwards]");

                // Add Y axis
                var y_2 = d3.scaleLinear()
                    .domain([0, 4500000])
                    .range([height, 0]);
                svg_2.append("g")
                    .call(d3.axisLeft(y_2));

                // gridlines in y axis function
                function make_y_gridlines() {
                    return d3.axisLeft(y_2)
                        .ticks(10)
                }

                // add the Y gridlines
                svg_2.append("g")
                    .attr("class", "grid")
                    .call(make_y_gridlines()
                        .tickSize(-width)
                        .tickFormat("")
                    )

                // Add the text label for the Y axis
                svg_2.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - (margin.left / 2) - 30)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text("Number of People Affected");

                // Add the line for confirmed
                const path = svg_2.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 3)
                    .attr("d", d3.line()
                        .x(function (d) {
                            return x_2(d.date)
                        })
                        .y(function (d) {
                            return y_2(d.value)
                        })
                    );

                // Add the label at the tip of the line
                svg_2.append("text")
                    .attr("transform", "translate("+(width - 50)+","+(y_2(data[0].value) - 10)+")")
                    .attr("dy", ".35em")
                    .attr("text-anchor", "start")
                    .style("font-size", "12px")
                    .style("font-weight", "bold")
                    .text(formatValue(data[0].value));

                // Add the line for deaths
                /*
                svg_2.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", "orange")
                    .attr("stroke-width", 3)
                    .attr("d", d3.line()
                        .x(function (d) {
                            return x_2(d.date)
                        })
                        .y(function (d) {
                            return y_2(d.death)
                        })
                    )
                */

                // Add the line for annotation
                var xy = [];
                xy.push({x: 510, y: 300})
                xy.push({x: 510, y: 0})
                svg_2.append("path")
                    .datum(xy)
                    .attr("fill", "none")
                    .attr("stroke", "pink")
                    .attr("stroke-width", 2)
                    .attr("d", d3.line()
                        .x(function(d) { return d.x;})
                        .y(function(d) { return d.y;})
                    )

                // Add annotation text
                svg_2.append("text")
                    .attr("x", 425)
                    .attr("y", 30)
                    .attr("text-anchor", "middle")
                    .style("font-size", "10px")
                    .style("font-weight", "bold")
                    .style("fill", "deeppink")
                    .text("States reopening after lockdown");

                // Add Tooltip for line chart
                var focus = svg_2.append("g")
                    .attr("class", "focus")
                    .style("display", "none");

                focus.append("circle")
                    .attr("r", 5);

                focus.append("rect")
                    .attr("class", "tooltip1")
                    .attr("width", 90)
                    .attr("height", 50)
                    .attr("x", -80)
                    .attr("y", -60)
                    .attr("rx", 4)
                    .attr("ry", 4);

                focus.append("text")
                    .attr("class", "tooltip-date")
                    .attr("x", -75)
                    .attr("y", -45);

                focus.append("text")
                    .attr("x", -75)
                    .attr("y", -32)
                    .text("Cases:");

                focus.append("text")
                    .attr("class", "tooltip-cases")
                    .attr("x", -40)
                    .attr("y", -32);

                svg_2.append("rect")
                    .attr("class", "overlay")
                    .attr("width", width)
                    .attr("height", height)
                    .on("mouseover", function() { focus.style("display", null); })
                    .on("mouseout", function() { focus.style("display", "none"); })
                    .on("mousemove", mousemove);

                var sorted_data = data
                sorted_data.sort(function(a, b) {
                    return a.date - b.date;
                });

                function mousemove() {
                    var x0 = x_2.invert(d3.mouse(this)[0]),
                        i = bisectDate(sorted_data, x0, 1),
                        d0 = sorted_data[i - 1],
                        d1 = sorted_data[i],
                        d = x0 - d0.date > d1.date - x0 ? d1 : d0;
                    focus.attr("transform", "translate(" + x_2(d.date) + "," + y_2(d.value) + ")");
                    focus.select(".tooltip-date").text(dateFormatter(d.date));
                    focus.select(".tooltip-cases").text(formatValue(d.value));
                }
            });
    }
</script>
</body>
</html>
