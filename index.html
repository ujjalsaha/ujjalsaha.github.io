<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script src='https://d3js.org/d3.v4.min.js'></script>
<style type="text/css">
    body {
        font: 12px sans-serif;
    }

    /* Link Styles */
    ul {
        padding: 0;
        width: 100%;
    }

    li {
        display: inline;
    }

    .selected {
        outline: none;
        text-decoration: none;
        display: inline-block;
        width: 19.5%;
        margin-right: 0.625%;
        text-align: center;
        line-height: 3;
        color: black;
        background: lightgray;
    }

    .slide_button {
        outline: none;
        text-decoration: none;
        display: inline-block;
        width: 19.5%;
        margin-right: 0.625%;
        text-align: center;
        line-height: 3;
        color: black;
    }

    li:last-child .slide_button {
        margin-right: 0;
    }

    .slide_button:link, .slide_button:visited, .slide_button:focus {
        background: burlywood;
    }

    .slide_button:hover {
        background: coral;
    }

    .slide_button:active {
        background: orangered;
        color: white;
    }
    /* STOP Link Styles */

    /* On mouse hover, lighten state color */
    path:hover {
        fill-opacity: .7;
    }

    /* Style for Custom Tooltip */
    div.tooltip {
        position: absolute;
        text-align: left;
        width: 150px;
        height: 50px;
        padding: 10px;
        font: 12px sans-serif;
        background: linen;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }

    /* Legend Position Style */
    .legend {
        position:absolute;
        left:1475px;
        top:730px;
    }

    .line {
         fill: none;
         stroke: steelblue;
         stroke-width: 2px;
    }

    .grid line {
        stroke: lightgrey;
        stroke-opacity: 0.7;
        shape-rendering: crispEdges;
    }

    .grid path {
        stroke-width: 0;
    }

    .header_div {
        padding-top: 20px;
        padding-bottom: 20px;
        padding-left: 20px;
        padding-right: 20px;
        max-width: 1600px;
        border: 2px solid #AAAE92;
        line-height: 20px;
        color: grey;
    }

    /*
    div {
        border: 3px solid #73ad21;

    }
    */
    svg {
        border: 1px solid #AAAE92;
    }

    span.guideline_header {
        font-weight: bold;
        font-size: large;
        color: gray
    }


    span.scene_header {
        font-weight: bold;
        font-size: large;
        color: darkmagenta;
    }

    span.bold {
        font-weight: bold;
    }

    .overlay {
        fill: none;
        pointer-events: all;
    }

    .focus circle {
        fill: #FF4521;
    }

    .focus text {
        font-size: 10px;
    }

    .tooltip1{
        fill: white;
        stroke: #000;
    }

    .unshaded_annotation_box{
        fill: gainsboro;
        fill-opacity: 0.4;
    }

    .annotation_box{
        fill: gainsboro;
        fill-opacity: 0.4;
    }

    .tooltip-date, .tooltip-cases, .tooltip-deaths {
        font-weight: bold;
    }
</style>


</head>
<body>
<div class="header_div">
    <span class="guideline_header">Narrative Visualization Walkthrough - Demonstrating Interactive Slideshow using COVID-19 Dataset for United States</span><br/>
    This is a demonstration of Narrative Visualisation using the Interactive Slideshow Structure using the COVID-19 Dataset of United States and tries to establish sequence of hierarchies putting forward the observation in terms of various Scenes as pages. The narrative visualization mainly explore the areas of overall cases and new cases within united states and how each state is affected in terms of case counts.
    This whole Visualization is based on three Scenes. Below is the brief description of each scene.
    <p>
        <span class="bold">Scene 1 (United States - COVID-19 Overall Case Count):</span> where author puts forwards the observation with overall cases on the states of United States and being within scene1 lets user explore with the tooltip, parameters and triggers.<br/>
        <span class="bold">Scene 2 (United States - COVID-19 New Case Count):</span> where author puts forwards the observation with new cases on the states of United States and being within scene2 lets user explore the visualization with the tooltip, parameters and triggers.<br/>
        <span class="bold">Scene 3 (United States - COVID-19 Top 10 States):</span> where author puts forwards the observation of top10 states with overall positive case counts vs top10 states with new case counts. Also letting the user explore the visualization with the tooltip, parameters and triggers. This is the summary and end of the narrative visualization.<br/>
    </p>
    <p>
        <span class="bold">Navigation: </span>Sections below explains more about each scene. In this narrative visualization, each scene is presented as individual slide and each slide is a webpage. To move to next scene/slides/pages, use the Prev and Next links below, or just click the button to jump to a page.
        <span style="font-size: 8px">(For best experience of the narrative visualisation, it is highly recommended to browse the slides in order, and not to jum slides)</span>
    </p>
</div>
<div class="header_div" style="text-align: center">
    <span style="color: #aaaaaa; text-decoration: underline">Prev</span>
    <ul>
        <li><a class="slide_button" href="#" onclick="overall_cases_map('april');">Apr 2020</a></li>
        <li><a class="slide_button" href="#" onclick="overall_cases_map('may');">May 2020</a></li>
        <li><a class="slide_button" href="#" onclick="overall_cases_map('june');">June 2020</a></li>
        <li><a class="slide_button" href="#" onclick="overall_cases_map('july');">July 2020</a></li>
    </ul>
    <a style="color:darkmagenta" href="new_cases.html">Next</a>

</div>
<div class="header_div">
    <span class="scene_header">Scene 1 - Overall Cases: </span> Shows impact of COVID-19 across states in United States but in terms of cumulative confirmed cases.
    The Scene is comprised of a Map chart and Line Chart that shows how overall cases has impacted various states since beginning of pandemic and how overall cases has increased over the period (cumulative) and is still increasing. More description and user control options are mentioned on respective charts.
</div>
<br/>
<div class="header_div">
    <!-- table border="1" -->
    <table>
        <tr>
            <td valign="top">
                <div style="max-width: 700px; line-height: 20px;padding: 20px">
                    <span class="guideline_header">Map - Showing Cumulative Confirmed Cases for Each States of United States</span><br/>
                    <p>
                        Seeing the total number of confirmed cases over time, can illustrate how the pandemic is expanding within the country.
                        The map shows cumulative cases for each states â€“ which means, till date the total number of people who have ever tested positive for coronavirus in United States, regardless of whether they have recovered or died.
                        The coloring scale on the map shows states that are red most affected in red to gradually fading to gray states that are having least number of cases. With the color grading scale, we are seeing see most states have been affected so far with with few of them having high concentration of infected people.
                        From the map, as an <span class="bold"> observation </span> we see states like New York, California, New Jersey, Florida, Texas etc are the hard hit areas with highest count of cumulative COVID-19 cases so far.
                    </p>
                    <p>
                        <span class="bold">User Controls:</span><br/>
                        The map is interactive with limited user controls and below are the user controls listed so user can explore further tweaking some parameters:<br/>
                        &nbsp;&nbsp;1. <span class="bold" style="text-decoration: underline; color: #aaaaaa"> Tooltip </span> -> Hovering over any state shows the cases counts and few other info.<br/>
                        &nbsp;&nbsp;2. <span class="bold" style="text-decoration: underline; color: #aaaaaa"> Cross Filter (Parameter: State)</span> -> Clicking a state from the map with bring up respective state's cumulative case count on the line chart.<br/>
                    </p>
                </div>
            </td>
            <td>
                <div id="svg_1" style="overflow: visible"></div>
            </td>
        </tr>
    </table>
</div>
<br/>
<div class="header_div">
    <!-- table border="1" -->
    <table>
        <tr>
            <td valign="top" >
                <div style="max-width: 700px; line-height: 20px;padding: 20px">
                    <span class="guideline_header">Line Chart - Cumulative Confirmed Cases for the United States</span><br/>
                    <p>
                        The line chart here shows:<br/>
                        &nbsp;&nbsp;1. For entire United States at what pace the overall cases are increasing<br/>
                        &nbsp;&nbsp;2. If user clicks on a state on the above map, as cross-filter is enable, the view on the line chart will switch to state level and will show state level overall case count.<br/>
                    </p>
                    <p>
                        A fine <span class="bold"> observation </span> we noticed this graph has an upward bend that can indicate more cases are being report in last few weeks then ever before.
                        Around late June, when the lockdown was lifted, there is sudden rise in the curve which would mean as states are opening more community spreading is also aggressive.
                        The color blue was used just to make it appealing, where blue itself has no color significance on the line chart.
                    </p>
                    <p>
                        <span class="bold">Annotations:</span><br/>
                        The line chart has also couple of annotations:<br/>
                        &nbsp;&nbsp;1. A vertical line that shows when states re-opened from lockdown and post lockdown effect of coronavirus on people.<br/>
                        &nbsp;&nbsp;2. At the tip of the line chart, show the total case count for the latest date.<br/>
                    </p>
                    <p>
                        <span class="bold">User Controls:</span><br/>
                        The line is also interactive with limited user controls and below are the user controls listed so user can explore further tweaking some parameters:<br/>
                        &nbsp;&nbsp;1. <span class="bold" style="text-decoration: underline; color: #aaaaaa"> Tooltip </span> -> Hovering over on line chart area will display the tooltip showing case count on that particular day.<br/>
                        &nbsp;&nbsp;2. <span class="bold" style="text-decoration: underline; color: #aaaaaa"> Button (Switch to Country Level)  </span> -> Switch on entire United States data at any point while interacting with state data.<br/>
                        &nbsp;&nbsp;3. <span class="bold" style="text-decoration: underline; color: #aaaaaa"> Cross Filter (State selected from Map)</span> -> Clicking a state from the above map will display corresponding state's case count line chart.<br/>
                    </p>
                </div>
            </td>
            <td valign="top">
                <div style="padding-left: 10px">
                    <input name="updateButton"
                           type="button"
                           value="Overall Cases for United States"
                           onclick="back_to_overall_country()" />
                </div>
                <div id="svg_2" ></div>
            </td>
        </tr>
    </table>
</div>
<br/>
<div class="header_div">
    <span class="guideline_header">Definitions of the Parameters:</span><br/>
    1. <span class="bold">Confirmed Cases:</span> A confirmed case is a person who has a positive test result from an FDA approved diagnostic molecular test.<br/>
    2: <span class="bold">Date: </span>Date on which data was compiled by the data provider.<br/>
    3. <span class="bold">States: </span>States of the United States.<br/> Cross-filter is enabled on this scnene letting the user to see state level confirmed cases.
</div>
<br/>
<div class="header_div">
    <span class="guideline_header">General Facts<br/></span>
    <span class="bold">Data Sources:</span><br/>
      1. COVID-19 data: <a href="https://covidtracking.com/data/api">https://covidtracking.com/data/api</a><br/>
      2. COVID-19 States Reopen dates: <a href="https://www.nytimes.com/interactive/2020/us/states-reopen-map-coronavirus.html">https://www.nytimes.com/interactive/2020/us/states-reopen-map-coronavirus.html</a><br/>
      3.
</div>

<script>
    var selected_month = ""
    var formatValue = d3.format(",")
    var parseDate = d3.timeParse("%Y%m%d"),
        bisectDate = d3.bisector(function(d) { return d.date; }).left,
        formatValue = d3.format(","),
        dateFormatter = d3.timeFormat("%B %d, %Y");

    // ########## Create SVG element for OVERALL CASES LINE CHART
    var margin = {top: 70, right: 30, bottom: 60, left: 80},
        width = 850 - margin.left - margin.right,
        height = 450 - margin.top - margin.bottom;
    var svg_2 = d3.select("#svg_2")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    // ########## Create SVG element for OVERALL CASES MAP
    width = 850; height = 500;
    var svg = d3.select("#svg_1")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

    overall_cases_map("april")

    function back_to_overall_country()
    {
        // console.log("222 selected month: " + selected_month)
        overall_cases_line(selected_month)
    }

    /* ################################################################ */
    /* ########################## LINE CHART ########################## */
    /* ################################################################ */
    function overall_cases_line(month) {
        // clear the canvas
        svg_2.selectAll("*").remove();

        selected_month = month
        // set the dimensions and margins of the graph
        margin = {top: 70, right: 30, bottom: 60, left: 80},
        width = 850 - margin.left - margin.right,
        height = 450 - margin.top - margin.bottom;

        //Read the data
        d3.csv("country_cumulative.csv",

            // When reading the csv, I must format variables:
            function (d) {
                val = {date: d3.timeParse("%Y%m%d")(d.date), value: d.positive, death: d.death}
                return val
            },

            // Now I can use this dataset:
            function (data) {
                //console.log("CountryCases")
                //console.log("Original Data Length: " + data.length)
                //console.log("Month: " + month)


                // Filter the dataset to get selected state rows only
                var filterdata = data.filter(function (d) {
                    if (month == "april"){
                        //console.log("Month April: " + month)
                        return d.date < parseDate("20200501")
                    }
                    else if (month == "may"){
                        //console.log("Month may: " + month)
                        return d.date < parseDate("20200601")
                    }
                    else if (month == "june"){
                        //console.log("Month June: " + month)
                        return d.date < parseDate("20200701")
                    }
                    else if (month == "july"){
                        //console.log("Month July: " + month)
                        return d.date < parseDate("20200725")
                    }
                    else{
                        return true
                    }
                })

                //console.log("Filtered Data Length: " + filterdata.length)

                // Add the title for the line graph
                svg_2.append("text")
                    .attr("x", (width / 2) - 10)
                    .attr("y", 0 - (margin.top / 2))
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .style("text-decoration", "underline")
                    .text("United States - Overall Case Count (Cumulative) ");

                // Add X axis --> it is a date format
                var x_2 = d3.scaleTime()
                    .domain(d3.extent(data, function (d) {
                        return d.date;
                    }))
                    .range([0, width]);
                svg_2.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x_2));

                // Add the text label for the x axis
                svg_2.append("text")
                    .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom - 20) + ")")
                    .style("text-anchor", "middle")
                    .text("Date - [Mar 16, 2020 Onwards]");

                svg_2.append("text")
                    .attr("transform", "translate(" + (-5) + " ," + (height + 16) + ")")
                    .style("text-anchor", "middle")
                    .style("font-size", "10px")
                    .text("Mar 16");

                svg_2.append("text")
                    .attr("transform", "translate(" + (width + 5) + " ," + (height + 16) + ")")
                    .style("text-anchor", "middle")
                    .style("font-size", "10px")
                    .text("Jul 24");

                // Add Y axis
                var y_2 = d3.scaleLinear()
                    .domain([0, 4500000])
                    .range([height, 0]);
                svg_2.append("g")
                    .call(d3.axisLeft(y_2));

                // add the Y gridlines
                function make_y_gridlines() {
                    return d3.axisLeft(y_2)
                        .ticks(10)
                }

                svg_2.append("g")
                    .attr("class", "grid")
                    .call(make_y_gridlines()
                        .tickSize(-width)
                        .tickFormat("")
                    )

                // Add the text label for the Y axis
                svg_2.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - (margin.left / 2) - 35)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text("Number of People Affected");

                // Add the line for confirmed
                const path = svg_2.append("path")
                    .datum(filterdata)
                    .interrupt()
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 3)
                    .attr("d", d3.line()
                        .x(function (d) {
                            return x_2(d.date)
                        })
                        .y(function (d) {
                            return y_2(d.value)
                        })
                    );

                // Add the CONFIRMED label at the tip of the line and annotation
                //console.log("Switch Month: " + month)
                switch (month) {
                    case 'july':
                        value = ""
                        pdate = parseDate("20200724")
                        for (i = 0; i < filterdata.length ; i++) {
                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                value = filterdata[i].value
                            }
                        }

                        svg_2.append("text")
                            .attr("transform", "translate("+(x_2(pdate) - 40)+","+(y_2(value) - 15)+")")
                            .attr("dy", ".35em")
                            .attr("text-anchor", "start")
                            .style("font-size", "12px")
                            .style("font-weight", "bold")
                            .text(formatValue(value));

                        xy = [];
                        xy.push({x: x_2(pdate), y: y_2(value) - 45})
                        xy.push({x: x_2(pdate), y: y_2(value) - 25})
                        svg_2.append("path")
                            .datum(xy)
                            .attr("fill", "none")
                            .attr("stroke", "deeppink")
                            .attr("stroke-width", 2)
                            .attr("d", d3.line()
                                .x(function(d) { return d.x;})
                                .y(function(d) { return d.y;})
                            )

                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 10)+","+(y_2(value) - 65)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("(NY, CA, TX, FL are mostly affected)");
                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 10)+","+(y_2(value) - 55)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("Cases as of July end");
                    case 'june':
                        value = ""
                        pdate = parseDate("20200630")
                        for (i = 0; i < filterdata.length ; i++) {
                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                value = filterdata[i].value
                            }
                        }

                        svg_2.append("text")
                            .attr("transform", "translate("+(x_2(pdate) - 40)+","+(y_2(value) - 15)+")")
                            .attr("dy", ".35em")
                            .attr("text-anchor", "start")
                            .style("font-size", "12px")
                            .style("font-weight", "bold")
                            .text(formatValue(value));

                        xy = [];
                        xy.push({x: x_2(pdate), y: y_2(value) - 45})
                        xy.push({x: x_2(pdate), y: y_2(value) - 25})
                        svg_2.append("path")
                            .datum(xy)
                            .attr("fill", "none")
                            .attr("stroke", "deeppink")
                            .attr("stroke-width", 2)
                            .attr("d", d3.line()
                                .x(function(d) { return d.x;})
                                .y(function(d) { return d.y;})
                            )

                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 10)+","+(y_2(value) - 65)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("(AZ, GA are also alarming)");
                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 10)+","+(y_2(value) - 55)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("Cases as of June end");
                    case 'may':
                        value = ""
                        pdate = parseDate("20200531")
                        for (i = 0; i < filterdata.length ; i++) {
                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                value = filterdata[i].value
                            }
                        }

                        svg_2.append("text")
                            .attr("transform", "translate("+(x_2(pdate) - 40)+","+(y_2(value) - 15)+")")
                            .attr("dy", ".35em")
                            .attr("text-anchor", "start")
                            .style("font-size", "12px")
                            .style("font-weight", "bold")
                            .text(formatValue(value));

                        xy = [];
                        xy.push({x: x_2(pdate), y: y_2(value) - 45})
                        xy.push({x: x_2(pdate), y: y_2(value) - 25})
                        svg_2.append("path")
                            .datum(xy)
                            .attr("fill", "none")
                            .attr("stroke", "deeppink")
                            .attr("stroke-width", 2)
                            .attr("d", d3.line()
                                .x(function(d) { return d.x;})
                                .y(function(d) { return d.y;})
                            )

                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 10)+","+(y_2(value) - 65)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("(CA, IL, TX, FL cases are alarming)");
                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 10)+","+(y_2(value) - 55)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("Cases as of May end");
                    case 'april':
                        value = ""
                        pdate = parseDate("20200430")
                        for (i = 0; i < filterdata.length ; i++) {
                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                value = filterdata[i].value
                                break;
                            }
                        }
                        svg_2.append("text")
                            .attr("transform", "translate("+(x_2(pdate) - 40)+","+(y_2(value) - 15)+")")
                            .attr("dy", ".35em")
                            .attr("text-anchor", "start")
                            .style("font-size", "12px")
                            .style("font-weight", "bold")
                            .text(formatValue(value));

                        xy = [];
                        xy.push({x: x_2(pdate), y: y_2(value) - 45})
                        xy.push({x: x_2(pdate), y: y_2(value) - 25})
                        svg_2.append("path")
                            .datum(xy)
                            .attr("fill", "none")
                            .attr("stroke", "deeppink")
                            .attr("stroke-width", 2)
                            .attr("d", d3.line()
                                .x(function(d) { return d.x;})
                                .y(function(d) { return d.y;})
                            )

                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 10)+","+(y_2(value) - 65)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("(New York with 300K is 30% of overall count)");
                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 10)+","+(y_2(value) - 55)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("Cases as of April end");
                        break;
                }

                // Add the line for deaths
                svg_2.append("path")
                    .datum(filterdata)
                    .attr("fill", "none")
                    .attr("stroke", "orange")
                    .attr("stroke-width", 3)
                    .attr("d", d3.line()
                        .x(function (d) {
                            return x_2(d.date)
                        })
                        .y(function (d) {
                            return y_2(d.death)
                        })
                    )

                // Add the DEATH label at the tip of the death cases line
                // Add the CONFIRMED label at the tip of the line and annotation
                switch (month) {
                    case 'july':
                        value = ""
                        pdate = parseDate("20200724")
                        for (i = 0; i < filterdata.length ; i++) {
                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                value = filterdata[i].death
                            }
                        }

                        svg_2.append("text")
                            .attr("transform", "translate("+(x_2(pdate))+","+(y_2(value) - 15)+")")
                            .attr("dy", ".35em")
                            .attr("text-anchor", "end")
                            .style("font-size", "12px")
                            .style("font-weight", "bold")
                            .text(formatValue(value));

                        xy = [];
                        xy.push({x: x_2(pdate) - 10, y: y_2(value) - 25})
                        xy.push({x: x_2(pdate) - 10, y: y_2(value) - 90})
                        svg_2.append("path")
                            .datum(xy)
                            .attr("fill", "none")
                            .attr("stroke", "deeppink")
                            .attr("stroke-width", 2)
                            .attr("d", d3.line()
                                .x(function(d) { return d.x;})
                                .y(function(d) { return d.y;})
                            )

                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 5)+","+(y_2(value) - 100)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("Overall deaths as of May end");

                    case 'june':
                        value = ""
                        pdate = parseDate("20200630")
                        for (i = 0; i < filterdata.length ; i++) {
                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                value = filterdata[i].death
                            }
                        }

                        svg_2.append("text")
                            .attr("transform", "translate("+(x_2(pdate))+","+(y_2(value) - 15)+")")
                            .attr("dy", ".35em")
                            .attr("text-anchor", "end")
                            .style("font-size", "12px")
                            .style("font-weight", "bold")
                            .text(formatValue(value));

                        xy = [];
                        xy.push({x: x_2(pdate) - 10, y: y_2(value) - 25})
                        xy.push({x: x_2(pdate) - 10, y: y_2(value) - 70})
                        svg_2.append("path")
                            .datum(xy)
                            .attr("fill", "none")
                            .attr("stroke", "deeppink")
                            .attr("stroke-width", 2)
                            .attr("d", d3.line()
                                .x(function(d) { return d.x;})
                                .y(function(d) { return d.y;})
                            )

                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 5)+","+(y_2(value) - 80)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("Overall deaths as of May end");
                    case 'may':
                        value = ""
                        pdate = parseDate("20200531")
                        for (i = 0; i < filterdata.length ; i++) {
                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                value = filterdata[i].death
                            }
                        }

                        svg_2.append("text")
                            .attr("transform", "translate("+(x_2(pdate))+","+(y_2(value) - 15)+")")
                            .attr("dy", ".35em")
                            .attr("text-anchor", "end")
                            .style("font-size", "12px")
                            .style("font-weight", "bold")
                            .text(formatValue(value));

                        xy = [];
                        xy.push({x: x_2(pdate) - 10, y: y_2(value) - 25})
                        xy.push({x: x_2(pdate) - 10, y: y_2(value) - 60})
                        svg_2.append("path")
                            .datum(xy)
                            .attr("fill", "none")
                            .attr("stroke", "deeppink")
                            .attr("stroke-width", 2)
                            .attr("d", d3.line()
                                .x(function(d) { return d.x;})
                                .y(function(d) { return d.y;})
                            )

                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) + 5)+","+(y_2(value) - 70)+")")
                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                            .style("fill", "deeppink").text("Overall deaths as of May end");
                    case 'april':
                        value = ""
                        pdate = parseDate("20200430")
                        for (i = 0; i < filterdata.length ; i++) {
                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                value = filterdata[i].death
                                break;
                            }
                        }
                        svg_2.append("text")
                            .attr("transform", "translate("+(x_2(pdate))+","+(y_2(value) - 10)+")")
                            .attr("dy", ".35em")
                            .attr("text-anchor", "end")
                            .style("font-size", "12px")
                            .style("font-weight", "bold")
                            .text(formatValue(value));

                        xy = [];
                        xy.push({x: x_2(pdate) - 10, y: y_2(value) - 25})
                        xy.push({x: x_2(pdate) - 10, y: y_2(value) - 40})
                        svg_2.append("path")
                            .datum(xy)
                            .attr("fill", "none")
                            .attr("stroke", "deeppink")
                            .attr("stroke-width", 2)
                            .attr("d", d3.line()
                                .x(function(d) { return d.x;})
                                .y(function(d) { return d.y;})
                            );

                        svg_2.append("text").attr("transform", "translate("+(x_2(pdate) - 30)+","+(y_2(value) - 50)+")")
                            .attr("dy", ".35em").attr("text-anchor", "start").style("font-size", "12px")
                            .style("fill", "deeppink").text("Overall deaths as of April end");
                        break;
                }

                // AT the end  Add the annotation
                if (month == "july") {
                    svg_2.append("rect")
                        .attr("class", "annotation_box")
                        .attr("width", 430)
                        .attr("height", 355)
                        .attr("x", 335)
                        .attr("y", -13)
                        .attr("rx", 4)
                        .attr("ry", 4);

                    xy = [];
                    xy.push({x: 300, y: 10})
                    xy.push({x: 335, y: 10})
                    svg_2.append("path")
                        .datum(xy)
                        .attr("fill", "none")
                        .attr("stroke", "deeppink")
                        .attr("stroke-width", 2)
                        .attr("d", d3.line()
                            .x(function (d) {
                                return d.x;
                            })
                            .y(function (d) {
                                return d.y;
                            })
                        )

                    svg_2.append("text")
                        .attr("x", 50)
                        .attr("y", 10)
                        .attr("text-anchor", "left")
                        .style("font-size", "12px")
                        .style("fill", "deeppink")
                        .text("Shaded area showing surge in overall counts");

                    svg_2.append("text")
                        .attr("x", 50)
                        .attr("y", 20)
                        .attr("text-anchor", "left")
                        .style("font-size", "12px")
                        .style("fill", "deeppink")
                        .text("as states were reopening from lockdown");
                }

                // Add Tooltip for line chart
                var focus = svg_2.append("g")
                    .attr("class", "focus")
                    .style("display", "none");

                var dfocus = svg_2.append("g")
                    .attr("class", "focus")
                    .style("display", "none");

                focus.append("circle")
                    .attr("r", 5);
                dfocus.append("circle")
                    .attr("r", 5);

                focus.append("rect")
                    .attr("class", "tooltip1")
                    .attr("width", 90)
                    .attr("height", 50)
                    .attr("x", -80)
                    .attr("y", -60)
                    .attr("rx", 4)
                    .attr("ry", 4);

                focus.append("text").attr("class", "tooltip-date").attr("x", -75).attr("y", -45);
                focus.append("text").attr("x", -75).attr("y", -32).text("Cases:");
                focus.append("text").attr("class", "tooltip-cases").attr("x", -40).attr("y", -32);
                focus.append("text").attr("x", -75).attr("y", -19).text("Deaths:");
                focus.append("text").attr("class", "tooltip-deaths").attr("x", -35).attr("y", -19);

                //console.log("filterdata[filterdata.length -1].date: " + filterdata[0].date)
                //console.log("x_2(filterdata[filterdata.length -1].date): " + x_2(filterdata[0].date))
                //console.log("filterdata[filterdata.length -1].value: " + filterdata[0].value)
                //console.log("y_2(filterdata[filterdata.length -1].value): " + y_2(filterdata[0].value))
                svg_2.append("rect")
                    .attr("class", "overlay")
                    .attr("width", x_2(filterdata[0].date))
                    .attr("height", 400)
                    .on("mouseover", function() { focus.style("display", null); dfocus.style("display", null);})
                    .on("mouseout", function() { focus.style("display", "none"); dfocus.style("display", "none");})
                    .on("mousemove", mousemove);

                    function mousemove() {

                        var sorted_data = filterdata
                        sorted_data.sort(function(a, b) {
                            return a.date - b.date;
                        });

                        var x0 = x_2.invert(d3.mouse(this)[0]),
                            i = bisectDate(sorted_data, x0, 1),
                            d0 = sorted_data[i - 1],
                            d1 = sorted_data[i],
                            df = x0 - d0.date.getTime() > d1.date.getTime() - x0 ? d1 : d0;
                        if (df.date.getTime() < sorted_data[sorted_data.length -1].date.getTime()) {
                            focus.attr("transform", "translate(" + x_2(df.date) + "," + y_2(df.value) + ")");
                            dfocus.attr("transform", "translate(" + x_2(df.date) + "," + y_2(df.death) + ")");
                            focus.select(".tooltip-date").text(dateFormatter(df.date));
                            focus.select(".tooltip-cases").text(formatValue(df.value));
                            focus.select(".tooltip-deaths").text(formatValue(df.death));
                        }
                        else
                        {

                        }

                    }
            });
    }

    /* ######################################################### */
    /* ########################## MAP ########################## */
    /* ######################################################### */
    function overall_cases_map(month) {
        selected_month = month
        margin = {top: 0, right: 0, bottom: 0, left: 0}
        width = 850;
        height = 500;

        // Define linear scale for output
        var color = d3.scaleLinear().domain([0, 300000]).range(["gainsboro", "red"])

        // D3 Projection
        var projection = d3.geoAlbersUsa()
            .translate([width / 2, height / 2])    // translate to center of screen
            .scale([1000]);          // scale things down so see entire US

        // Define path generator
        var path = d3.geoPath()               // path generator that will convert GeoJSON to SVG paths
            .projection(projection);  // tell path generator to use albersUsa projection

        // Clear the SVG Chart
        svg.selectAll(`*`).remove();

        var layer1 = svg.append('g');
        var layer2 = svg.append('g');
        var layer3 = svg.append('g');
        var layer4 = svg.append('g');

        // Append Div for tooltip to SVG
        var div = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Load Cumulative State Data
        d3.csv("state_cumulative/" + month + ".csv", function (data) {
            //color.domain([0,500000]); // setting the range of the input data

            var selected_state = ""


            // Load GeoJSON data and merge with states data
            d3.json("us-states.json", function (json) {

                // Loop through each state data value in the .csv file
                for (var i = 0; i < data.length; i++) {

                    var dataState = data[i].state;
                    var dataValue = data[i].positive;
                    var dataDeath = data[i].death;
                    var dataPopulation = data[i].population;
                    var dataRopen = data[i].reopen;

                    // Find the corresponding state inside the GeoJSON
                    for (var j = 0; j < json.features.length; j++) {
                        var jsonState = json.features[j].properties.name;

                        if (dataState === jsonState) {

                            // Copy the data value into the JSON
                            json.features[j].properties.state = dataState;
                            json.features[j].properties.population = dataPopulation;
                            json.features[j].properties.positive = dataValue;
                            json.features[j].properties.death = dataDeath;
                            json.features[j].properties.reopen = dataRopen;

                            // Stop looking through the JSON
                            break;
                        }
                    }
                }

                // Bind the data to the SVG and create one path per GeoJSON feature
                layer1.selectAll("path")
                    .data(json.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .style("stroke", "#fff")
                    .style("stroke-width", "1")
                    //.style("pointer-events", "none")
                    .style("fill", function (d) {
                        // Get data value
                        var value = d.properties.positive;

                        if (value) {
                            //If value existsâ€¦
                            return color(value);
                        } else {
                            return "gray";
                        }
                    })
                    .on("mouseover", function (d) {
                        var tooltip_html = "<span class='bold' style='font-size: small;color: maroon'>" + d.properties.state + "</span><br/>" +
                            "<span>Population: </span>" + d.properties.population + "<br/>" +
                            "<span>Overall Cases: </span>" + formatValue(d.properties.positive) + "<br/>" +
                            "<span>Overall Deaths: </span>" + formatValue(d.properties.death) + "<br/>";
                        div.transition()
                            .duration(200)
                            .style("opacity", .9);
                        div.html(tooltip_html)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 15) + "px")
                    })
                    // fade out tooltip on mouse out
                    .on("mouseout", function (d) {
                        div.transition()
                            .duration(500)
                            .style("opacity", 0);
                    })
                    .on("click", function (d) {
                        // Read the data
                        selected_state = d.properties.state
                        selected_state_reopen = parseDate(d.properties.reopen)
                        d3.csv("all_states_master.csv",
                            // When reading the csv, I must format variables:
                            function (d) {
                                val = {
                                    state: d.state,
                                    date: parseDate(d.date),
                                    positive: d.positive,
                                    death: d.death
                                }
                                // console.log("Val: " + val)
                                return val
                            },

                            // Now I can use this dataset:
                            function (data) {
                                // Clear the SVG Chart
                                svg_2.selectAll(`*`).remove();

                                // Filter the dataset to get selected state rows only
                                var filterdata_temp = data.filter(function (d) {
                                    return d.state == selected_state
                                })
                                // Filter the dataset to get selected date rows only
                                var filterdata = filterdata_temp.filter(function (d) {
                                    if (month == "april"){
                                        //console.log("Month April: " + month)
                                        return d.date < parseDate("20200501")
                                    }
                                    else if (month == "may"){
                                        //console.log("Month may: " + month)
                                        return d.date < parseDate("20200601")
                                    }
                                    else if (month == "june"){
                                        //console.log("Month June: " + month)
                                        return d.date < parseDate("20200701")
                                    }
                                    else if (month == "july"){
                                        //console.log("Month July: " + month)
                                        return d.date < parseDate("20200725")
                                    }
                                    else{
                                        return true
                                    }
                                })
                                margin = {top: 70, right: 30, bottom: 60, left: 80};
                                width = 850 - margin.left - margin.right;
                                height = 450 - margin.top - margin.bottom;

                                var max_positive = filterdata[0].positive
                                var min_positive = filterdata[filterdata.length - 1].positive
                                var max_death = filterdata[0].death
                                var min_death = filterdata[filterdata.length - 1].death

                                console.log("max_positive: " + max_positive)
                                console.log("min_positive: " + min_positive)
                                console.log("max_death: " + max_death)
                                console.log("min_death: " + min_death)
                                console.log("width: " + width)
                                console.log("height: " + height)

                                // Add Y axis
                                var y_3 = d3.scaleLinear()
                                    .domain([0, filterdata_temp[0].positive])
                                    .range([height, 0]);
                                svg_2.append("g")
                                    .call(d3.axisLeft(y_3)
                                    );

                                // gridlines in y axis function
                                function make_y_gridlines() {
                                    return d3.axisLeft(y_3)
                                }

                                // add the Y gridlines
                                svg_2.append("g")
                                    .attr("class", "grid")
                                    .call(make_y_gridlines()
                                        .tickSize(-width)
                                        .tickFormat("")
                                    )

                                // Add the text label for the Y axis
                                svg_2.append("text")
                                    .attr("transform", "rotate(-90)")
                                    .attr("y", 0 - (margin.left / 2) - 35)
                                    .attr("x", 0 - (height / 2))
                                    .attr("dy", "1em")
                                    .style("text-anchor", "middle")
                                    .text("Number of People Affected");

                                filterdata.sort(function (a, b) {
                                    return a.date - b.date;
                                });

                                // Add the title for the line graph
                                svg_2.append("text")
                                    .attr("x", (width / 2) - 10)
                                    .attr("y", 0 - (margin.top / 2))
                                    .attr("text-anchor", "middle")
                                    .style("font-size", "16px")
                                    .style("text-decoration", "underline")
                                    .text(d.properties.state + " - Overall Case Count (Cumulative) ");

                                // Add X axis --> it is a date format
                                var x_3 = d3.scaleTime()
                                    .domain(d3.extent(filterdata_temp, function (d) {
                                        return d.date;
                                    }))
                                    .range([0, width]);
                                svg_2.append("g")
                                    .attr("transform", "translate(0," + height + ")")
                                    .call(d3.axisBottom(x_3));

                                // Add the text label for the x axis
                                svg_2.append("text")
                                    .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom - 20) + ")")
                                    .style("text-anchor", "middle")
                                    .text("Date - [Mar 16, 2020 Onwards]");

                                svg_2.append("text")
                                    .attr("transform", "translate(" + (-5) + " ," + (height + 16) + ")")
                                    .style("text-anchor", "middle")
                                    .style("font-size", "10px")
                                    .text("Mar 16");

                                e_date = (month == "april") ? "Apr 30" : (month == "may") ? "May 31" : (month =="june") ? "Jun 30" : "Jul 24";
                                svg_2.append("text")
                                    .attr("transform", "translate(" + (width + 5) + " ," + (height + 16) + ")")
                                    .style("text-anchor", "middle")
                                    .style("font-size", "10px")
                                    .text(e_date);

                                // Add the line for confirmed
                                const path = svg_2.append("path")
                                    .datum(filterdata)
                                    .interrupt()
                                    .attr("fill", "none")
                                    .attr("stroke", "steelblue")
                                    .attr("stroke-width", 3)
                                    .attr("d", d3.line()
                                        .x(function (d) {
                                            return x_3(d.date)
                                        })
                                        .y(function (d) {
                                            return y_3(d.positive)
                                        })
                                    );

                                // Add the CONFIRMED label at the tip of the line and annotation
                                //console.log("Switch Month: " + month)
                                switch (month) {
                                    case 'july':
                                        value = ""
                                        pdate = parseDate("20200724")
                                        for (i = 0; i < filterdata.length ; i++) {
                                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                                value = filterdata[i].positive
                                            }
                                        }

                                        svg_2.append("text")
                                            .attr("transform", "translate("+(x_3(pdate) + 20)+","+(y_3(value) - 15)+")")
                                            .attr("dy", ".35em")
                                            .attr("text-anchor", "end")
                                            .style("font-size", "12px")
                                            .style("font-weight", "bold")
                                            .text(formatValue(value));

                                        xy = [];
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 45})
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 25})
                                        svg_2.append("path")
                                            .datum(xy)
                                            .attr("fill", "none")
                                            .attr("stroke", "deeppink")
                                            .attr("stroke-width", 2)
                                            .attr("d", d3.line()
                                                .x(function(d) { return d.x;})
                                                .y(function(d) { return d.y;})
                                            )

                                        svg_2.append("text").attr("transform", "translate("+(x_3(pdate))+","+(y_3(value) - 55)+")")
                                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                                            .style("fill", "deeppink").text("Cases till July end");
                                    case 'june':
                                        value = ""
                                        pdate = parseDate("20200630")
                                        for (i = 0; i < filterdata.length ; i++) {
                                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                                value = filterdata[i].positive
                                            }
                                        }

                                        svg_2.append("text")
                                            .attr("transform", "translate("+(x_3(pdate) + 10)+","+(y_3(value) - 15)+")")
                                            .attr("dy", ".35em")
                                            .attr("text-anchor", "end")
                                            .style("font-size", "12px")
                                            .style("font-weight", "bold")
                                            .text(formatValue(value));

                                        xy = [];
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 45})
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 25})
                                        svg_2.append("path")
                                            .datum(xy)
                                            .attr("fill", "none")
                                            .attr("stroke", "deeppink")
                                            .attr("stroke-width", 2)
                                            .attr("d", d3.line()
                                                .x(function(d) { return d.x;})
                                                .y(function(d) { return d.y;})
                                            )

                                        svg_2.append("text").attr("transform", "translate("+(x_3(pdate) + 40)+","+(y_3(value) - 55)+")")
                                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                                            .style("fill", "deeppink").text("Cases until June end");
                                    case 'may':
                                        value = ""
                                        pdate = parseDate("20200531")
                                        for (i = 0; i < filterdata.length ; i++) {
                                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                                value = filterdata[i].positive
                                            }
                                        }

                                        svg_2.append("text")
                                            .attr("transform", "translate("+(x_3(pdate) + 10)+","+(y_3(value) - 15)+")")
                                            .attr("dy", ".35em")
                                            .attr("text-anchor", "end")
                                            .style("font-size", "12px")
                                            .style("font-weight", "bold")
                                            .text(formatValue(value));

                                        xy = [];
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 45})
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 25})
                                        svg_2.append("path")
                                            .datum(xy)
                                            .attr("fill", "none")
                                            .attr("stroke", "deeppink")
                                            .attr("stroke-width", 2)
                                            .attr("d", d3.line()
                                                .x(function(d) { return d.x;})
                                                .y(function(d) { return d.y;})
                                            )

                                        svg_2.append("text").attr("transform", "translate("+(x_3(pdate))+","+(y_3(value) - 55)+")")
                                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                                            .style("fill", "deeppink").text("Cases until May end");
                                    case 'april':
                                        value = ""
                                        pdate = parseDate("20200430")
                                        for (i = 0; i < filterdata.length ; i++) {
                                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                                value = filterdata[i].positive
                                                break;
                                            }
                                        }
                                        svg_2.append("text")
                                            .attr("transform", "translate("+(x_3(pdate) + 10)+","+(y_3(value) - 15)+")")
                                            .attr("dy", ".35em")
                                            .attr("text-anchor", "end")
                                            .style("font-size", "12px")
                                            .style("font-weight", "bold")
                                            .text(formatValue(value));

                                        xy = [];
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 45})
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 25})
                                        svg_2.append("path")
                                            .datum(xy)
                                            .attr("fill", "none")
                                            .attr("stroke", "deeppink")
                                            .attr("stroke-width", 2)
                                            .attr("d", d3.line()
                                                .x(function(d) { return d.x;})
                                                .y(function(d) { return d.y;})
                                            )

                                        svg_2.append("text").attr("transform", "translate("+(x_3(pdate))+","+(y_3(value) - 55)+")")
                                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                                            .style("fill", "deeppink").text("Cases until April end");
                                        break;
                                }


                                // Add the line for deaths
                                svg_2.append("path")
                                    .datum(filterdata)
                                    .attr("fill", "none")
                                    .attr("stroke", "orange")
                                    .attr("stroke-width", 3)
                                    .attr("d", d3.line()
                                        .x(function (d) {
                                            return x_3(d.date)
                                        })
                                        .y(function (d) {
                                            return y_3(d.death)
                                        })
                                    )
                                switch (month) {
                                    case 'july':
                                        value = ""
                                        pdate = parseDate("20200724")
                                        for (i = 0; i < filterdata.length ; i++) {
                                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                                value = filterdata[i].death
                                            }
                                        }

                                        svg_2.append("text")
                                            .attr("transform", "translate("+(x_3(pdate))+","+(y_3(value) - 15)+")")
                                            .attr("dy", ".35em")
                                            .attr("text-anchor", "end")
                                            .style("font-size", "12px")
                                            .style("font-weight", "bold")
                                            .text(formatValue(value));

                                        xy = [];
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 25})
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 50})
                                        svg_2.append("path")
                                            .datum(xy)
                                            .attr("fill", "none")
                                            .attr("stroke", "deeppink")
                                            .attr("stroke-width", 2)
                                            .attr("d", d3.line()
                                                .x(function(d) { return d.x;})
                                                .y(function(d) { return d.y;})
                                            )

                                        svg_2.append("text").attr("transform", "translate("+(x_3(pdate) + 5)+","+(y_3(value) - 60)+")")
                                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                                            .style("fill", "deeppink").text("Overall deaths as of May end");

                                    case 'june':
                                        value = ""
                                        pdate = parseDate("20200630")
                                        for (i = 0; i < filterdata.length ; i++) {
                                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                                value = filterdata[i].death
                                            }
                                        }

                                        svg_2.append("text")
                                            .attr("transform", "translate("+(x_3(pdate))+","+(y_3(value) - 15)+")")
                                            .attr("dy", ".35em")
                                            .attr("text-anchor", "end")
                                            .style("font-size", "12px")
                                            .style("font-weight", "bold")
                                            .text(formatValue(value));

                                        xy = [];
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 15})
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 35})
                                        svg_2.append("path")
                                            .datum(xy)
                                            .attr("fill", "none")
                                            .attr("stroke", "deeppink")
                                            .attr("stroke-width", 2)
                                            .attr("d", d3.line()
                                                .x(function(d) { return d.x;})
                                                .y(function(d) { return d.y;})
                                            )

                                        svg_2.append("text").attr("transform", "translate("+(x_3(pdate) + 5)+","+(y_3(value) - 40)+")")
                                            .attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
                                            .style("fill", "deeppink").text("Overall deaths as of May end");
                                    case 'may':
                                        value = ""
                                        pdate = parseDate("20200531")
                                        for (i = 0; i < filterdata.length ; i++) {
                                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                                value = filterdata[i].death
                                            }
                                        }

                                        svg_2.append("text")
                                            .attr("transform", "translate("+(x_3(pdate))+","+(y_3(value) - 10)+")")
                                            .attr("dy", ".35em")
                                            .attr("text-anchor", "end")
                                            .style("font-size", "12px")
                                            .style("font-weight", "bold")
                                            .text(formatValue(value));

                                        xy = [];
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 15})
                                        xy.push({x: x_3(pdate) - 10, y: y_3(value) - 25})
                                        svg_2.append("path")
                                            .datum(xy)
                                            .attr("fill", "none")
                                            .attr("stroke", "deeppink")
                                            .attr("stroke-width", 2)
                                            .attr("d", d3.line()
                                                .x(function(d) { return d.x;})
                                                .y(function(d) { return d.y;})
                                            )

                                        svg_2.append("text").attr("transform", "translate("+(x_3(pdate) + 10)+","+(y_3(value) - 30)+")")
                                            .attr("dy", ".35em").attr("text-anchor", "middle").style("font-size", "12px")
                                            .style("fill", "deeppink").text("Overall deaths as of May end");
                                    case 'april':
                                        value = ""
                                        pdate = parseDate("20200430")
                                        for (i = 0; i < filterdata.length ; i++) {
                                            if (filterdata[i].date.getTime() == pdate.getTime()) {
                                                value = filterdata[i].death
                                                break;
                                            }
                                        }
                                        svg_2.append("text")
                                            .attr("transform", "translate("+(x_3(pdate))+","+(y_3(value) - 10)+")")
                                            .attr("dy", ".35em")
                                            .attr("text-anchor", "end")
                                            .style("font-size", "12px")
                                            .style("font-weight", "bold")
                                            .text(formatValue(value));

                                        svg_2.append("text").attr("transform", "translate("+(x_3(pdate) - 40)+","+(y_3(value) - 25)+")")
                                            .attr("dy", ".35em").attr("text-anchor", "start").style("font-size", "12px")
                                            .style("fill", "deeppink").text("Overall deaths as of April end");
                                        break;
                                }

                                /*
                                // Add the annotation
                                svg_2.append("rect")
                                    .attr("class", "annotation_box")
                                    .attr("width", width - (width - x_3(selected_state_reopen)))
                                    .attr("height", 370)
                                    .attr("x", x_3(selected_state_reopen))
                                    .attr("y", -20)
                                    .attr("rx", 4)
                                    .attr("ry", 4);

                                svg_2.append("text")
                                    .attr("x", 640)
                                    .attr("y", -40)
                                    .attr("text-anchor", "middle")
                                    .style("font-size", "12px")
                                    .style("fill", "deeppink")
                                    .text("Shaded area showing reopening after");

                                svg_2.append("text")
                                    .attr("x", 640)
                                    .attr("y", -25)
                                    .attr("text-anchor", "middle")
                                    .style("font-size", "12px")
                                    .style("fill", "deeppink")
                                    .text("lockdown and affected overall counts");
                                */

                                // Add Tooltip for line chart
                                var dfocus = svg_2.append("g")
                                    .attr("class", "focus")
                                    .style("display", "none");

                                var focus = svg_2.append("g")
                                    .attr("class", "focus")
                                    .style("display", "none");

                                dfocus.append("circle")
                                    .attr("r", 5);
                                focus.append("circle")
                                    .attr("r", 5);

                                focus.append("rect")
                                    .attr("class", "tooltip1")
                                    .attr("width", 80)
                                    .attr("height", 50)
                                    .attr("x", -80)
                                    .attr("y", -60)
                                    .attr("rx", 4)
                                    .attr("ry", 4);

                                focus.append("text").attr("class", "tooltip-date").attr("x", -75).attr("y", -45);
                                focus.append("text").attr("x", -75).attr("y", -32).text("Cases:");
                                focus.append("text").attr("class", "tooltip-cases").attr("x", -40).attr("y", -32);
                                focus.append("text").attr("x", -75).attr("y", -19).text("Deaths:");
                                focus.append("text").attr("class", "tooltip-deaths").attr("x", -35).attr("y", -19);

                                console.log("filterdata[0].date: " + filterdata[0].date)
                                svg_2.append("rect")
                                    .attr("class", "overlay")
                                    .attr("width", x_3(filterdata[0].date))
                                    .attr("height", 400)
                                    .on("mouseover", function () {
                                        focus.style("display", null);
                                        dfocus.style("display", null);
                                    })
                                    .on("mouseout", function () {
                                        focus.style("display", "none");
                                        dfocus.style("display", "none");
                                    })
                                    .on("mousemove", mousemove);

                                function mousemove() {
                                    var x0 = x_3.invert(d3.mouse(this)[0]),
                                        i = bisectDate(filterdata, x0, 1),
                                        d0 = filterdata[i],
                                        d1 = filterdata[i + 1],
                                        d = x0 - d0.date >= d1.date - x0 ? d1 : d0;
                                    focus.attr("transform", "translate(" + x_3(d.date) + "," + y_3(d.positive) + ")");
                                    dfocus.attr("transform", "translate(" + x_3(d.date) + "," + y_3(d.death) + ")");
                                    focus.select(".tooltip-date").text(dateFormatter(d.date));
                                    focus.select(".tooltip-cases").text(formatValue(d.positive))
                                    focus.select(".tooltip-deaths").text(formatValue(d.death));
                                }
                            }
                        );
                    });
            });
        });

        //Width and height of map
        var margin = {top: 0, right: 0, bottom: 0, left: 0}
        var width = 850;
        var height = 500;

        // Add the title for the map
        layer3.append("text")
            .attr("x", (width / 2))
            .attr("y", 0 - (margin.top / 2) + 20)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .style("text-decoration", "underline")
            .text("United States - Overall Case Count (Cumulative) ");

        if (month != "april") {

            // California
            var xy = [];
            xy.push({x: 130, y: 320})
            xy.push({x: width / 2 - 120, y: height - 20})
            layer2.append("path").datum(xy).attr("fill", "none").attr("stroke", "deeppink").attr("stroke-width", 2)
                .attr("d", d3.line()
                    .x(function (d) {return d.x;})
                    .y(function (d) {return d.y;})
                );

            // Texas
            var xy = [];
            xy.push({x: width / 2 + 20, y: height - 120})
            xy.push({x: width / 2 + 20, y: height - 20})
            layer2.append("path").datum(xy).attr("fill", "none").attr("stroke", "deeppink").attr("stroke-width", 2)
                .attr("d", d3.line()
                    .x(function (d) {return d.x;})
                    .y(function (d) {return d.y;})
                );

            // Florida
            var xy = [];
            xy.push({x: width / 2 + 220, y: height - 110})
            xy.push({x: width / 2 + 150, y: height - 20})
            layer2.append("path").datum(xy).attr("fill", "none").attr("stroke", "deeppink").attr("stroke-width", 2)
                .attr("d", d3.line()
                    .x(function (d) {return d.x;})
                    .y(function (d) {return d.y;})
                );

            // Illinois
            var xy = [];
            xy.push({x: width - 320, y: 60})
            xy.push({x: width - 320, y: 200})
            layer2.append("path").datum(xy).attr("fill", "none").attr("stroke", "deeppink").attr("stroke-width", 2)
                .attr("d", d3.line()
                    .x(function (d) {return d.x;})
                    .y(function (d) {return d.y;})
                );


            if (month == "june"){
                // Arizona
                var xy = [];
                xy.push({x: 200, y: 320})
                xy.push({x: width / 2 - 100, y: height - 20})
                layer2.append("path").datum(xy).attr("fill", "none").attr("stroke", "deeppink").attr("stroke-width", 2)
                    .attr("d", d3.line()
                        .x(function (d) {return d.x;})
                        .y(function (d) {return d.y;})
                    );

                // Georgia
                var xy = [];
                xy.push({x: width / 2 + 190, y: height - 150})
                xy.push({x: width / 2 + 120, y: height - 20})
                layer2.append("path").datum(xy).attr("fill", "none").attr("stroke", "deeppink").attr("stroke-width", 2)
                    .attr("d", d3.line()
                        .x(function (d) {return d.x;})
                        .y(function (d) {return d.y;})
                    );

                layer3.append("text").attr("x", width / 2).attr("y", height - 10).style("font-size", "12px").attr("text-anchor", "middle").style("fill", "deeppink")
                    .text("Arizona, Georgia are spiking up too. CA, TX, FL continue to spike.")

                layer3.append("text").attr("x", width - 380).attr("y", 50).attr("text-anchor", "middle").style("font-size", "12px").style("fill", "deeppink")
                    .text("Illinois is not spiking at an alarming rate unlike NY, CA.")
            }


            if (month == "july") {
                layer3.append("text").attr("x", width / 2).attr("y", height - 10).style("font-size", "12px").attr("text-anchor", "middle").style("fill", "deeppink")
                    .text("By July, CA, TX, FL are worst affected places along with NY. These all are also top populated States.")

                layer3.append("text").attr("x", width - 380).attr("y", 50).attr("text-anchor", "middle").style("font-size", "12px").style("fill", "deeppink")
                    .text("Unlike other red states, Illinois stopped spiking at alarming rate.")

            }
            if (month == "may") {
                layer3.append("text").attr("x", width - 380).attr("y", 50).attr("text-anchor", "middle").style("font-size", "12px").style("fill", "deeppink")
                    .text("Illinois is spiking too along with few other east states.")

                layer3.append("text").attr("x", width / 2).attr("y", height - 10).style("font-size", "12px").attr("text-anchor", "middle").style("fill", "deeppink")
                    .text("CA is spiking at an alarming rates. Texas and Florida as well. ")
            }

            // Alaska
            var xy = [];
            xy.push({x: 75, y: height - 120})
            xy.push({x: 100, y: height - 70})
            layer2.append("path")
                .datum(xy)
                .attr("fill", "none")
                .attr("stroke", "deeppink")
                .attr("stroke-width", 2)
                .attr("d", d3.line()
                    .x(function (d) {
                        return d.x;
                    })
                    .y(function (d) {
                        return d.y;
                    })
                );
            layer3.append("text").attr("x", 5).attr("y", 360).style("font-size", "12px").style("fill", "deeppink").text("Gray color states like Alaska")
            layer3.append("text").attr("x", 5).attr("y", 370).style("font-size", "12px").style("fill", "deeppink").text("meaning still low overall cases.");

        }

        // NEW York Annotation at the maps
        if ((month == "april") || (month == "july"))
        {
            var xy = [];
            xy.push({x: width - 180, y: 100})
            xy.push({x: width - 180, y: 160})
            layer2.append("path")
                .datum(xy)
                .attr("fill", "none")
                .attr("stroke", "deeppink")
                .attr("stroke-width", 2)
                .attr("d", d3.line()
                    .x(function (d) {return d.x;})
                    .y(function (d) {return d.y;})
                );
        }

        new_york_comment_line1 = ""
        new_york_comment_line2 = ""
        if (month == "april"){
            new_york_comment_line1 = "New York is the first state to cross";
            new_york_comment_line2 = "300K cases. Other states are spiking.";
        }
        if (month == "july"){
            new_york_comment_line1 = "New York is now the oldest in";
            new_york_comment_line2 = "league with high overall cases.";
        }
        layer3.append("text").attr("x", width - 210).attr("y", 80).attr("text-anchor", "middle").style("font-size", "12px").style("fill", "deeppink").text(new_york_comment_line1);
        layer3.append("text").attr("x", width - 210).attr("y", 90).attr("text-anchor", "middle").style("font-size", "12px").style("fill", "deeppink").text(new_york_comment_line2);

        // Add the title for the map
        layer3.append("text")
            .attr("x", (width / 2))
            .attr("y", 0 - (margin.top / 2) + 20)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .style("text-decoration", "underline")
            .text("United States - Overall Case Count (Cumulative) ");


        // Add a legend
        var l_w = 120, l_h = 210;
        layer3.append("text")
            .attr("x", 780)
            .attr("y", 245)
            .attr("text-anchor", "middle")
            .style("font-size", "11px")
            .style("font-weight", "bold")
            .style("text-decoration", "underline")
            .text("Cumulative");
        layer3.append("text")
            .attr("x", 780)
            .attr("y", 260)
            .attr("text-anchor", "middle")
            .style("font-size", "11px")
            .style("font-weight", "bold")
            .style("text-decoration", "underline")
            .text("Case Count");

        var legend = layer4.append("defs")
            .append("svg:linearGradient")
            .attr("id", "gradient")
            .attr("x1", "100%")
            .attr("y1", "0%")
            .attr("x2", "100%")
            .attr("y2", "100%")
            .attr("spreadMethod", "pad");

        legend.append("stop")
            .attr("offset", "0%")
            .attr("stop-color", "red")
            .attr("stop-opacity", 1);

        legend.append("stop")
            .attr("offset", "100%")
            .attr("stop-color", "gainsboro")
            .attr("stop-opacity", 1);

        layer3.append("rect")
            .attr("width", 20)
            .attr("height", 200)
            .style("fill", "url(#gradient)")
            .attr("transform", "translate(755,275)");

        var y = d3.scaleLinear()
            .range([200, 0])
            .domain([0, 300000]);
        var yAxis = d3.axisRight(y).ticks(10)
        layer4.attr("class", "y axis")
            .attr("transform", "translate(777,275)")
            .call(yAxis)

        //console.log("111 selected month: " + selected_month)
        back_to_overall_country()
    }
</script>


</body>
</html>
